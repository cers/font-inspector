<!DOCTYPE html>
<meta charset="utf-8">
<script>
window.onmessage = function(aMsg) {
  document.body.className = "";
  var data = JSON.parse(aMsg);
  if (data.method == "HIDE") {
    document.body.className = "nonode";
  } else {
    document.body.className = "";
    if (data.fonts.length == 0) {
      // NO FONTS
    } else {
      var usedfont = data.fonts[0]; // we work only on the first font
      var style = data.computedStyle;
      var info = {
        family: {
            value: usedfont.CSSFamilyName
        },
        URI: {
            value: usedfont.URI
        },
        format: {
            value: usedfont.format
        },
        meta: {
            value: usedfont.metadata,
            default: ""
        },
        color: {
            value: style.color
        },
        families: {
            value: style.font_family.replace(usedfont.CSSFamilyName, "<strong>"+usedfont.CSSFamilyName+"</strong>"),
        },
        size: {
            value: style.font_size
        },
        font_size_adjust: {
            value: style.font_size_adjust,
            default: "none"
        },
        font_stretch: {
            value: style.font_stretch,
            default: "normal"
        },
        font_variant: {
            value: style.font_variant,
            default: "normal"
        },
        font_weight: {
            value: style.font_weight,
            default: "normal"
        },
        letter_spacing: {
            value: style.font_spacing,
        default:
            "auto"
        },
        line_height: {
            value: style.line_height,
            default: "auto"
        },
        opacity: {
            value: style.opacity,
            default: "1"
        },
        text_decoration: {
            value: style.text_decoration,
            default: "none"
        },
        text_indent: {
            value: style.text_indent,
            default: "0px"
        },
        text_shadow: {
            value: style.text_shadow,
            default: "none"
        },
        text_transform: {
            value: style.text_transform
            default: "none"
        },
        white_space: {
            value: style.white_space,
            default: "normal"
        },
        word_spacing: {
            value: style.word_spacing,
            default: "0px"
        },
        word_wrap: {
            value: style.word_wrap,
            default: "normal"
        },
      };
      for (var i in info) {
        var v = document.querySelector("#info-" + _toDash(i));
        if (v.dataset.attribute) {
            v.setAttribute(v.dataset.attribute, info[i].value);
        } else {
            v.innerHTML = info[i].value;
        }
        if (info[i].default && info[i].value == info[i].default) {
            v.parentNode.classList.add("default");
        } else {
            v.parentNode.classList.remove("default");
        }
      }
    }
  }
}

function _toDash(aStr) {
    return aStr.replace("_", "-", "g");
}

window.hideMeta = function() {
    document.querySelector("#meta").classList.add("hidden");
}

window.showMeta = function() {
    document.querySelector("#meta").classList.remove("hidden");
}

</script>

<style>
  #body {
      border: 2px solid black;
      overflow: auto; /*it has to fit in the window*/
      box-shadow: inset 0 0 1px #999, 0 0 3px #111;
      font-family: sans-serif;
      margin: 10px;
      position: relative;
  }

  #noview {
      display: none;
  }

  body.nonode > #noview {
      display: block;
  }
  body.nonode > #view {
      display: none;
  }

  .default {
      opacity: 0.2;
  }

  #meta {
      position: absolute;
      top: 10px; left: 10px;
      width: 276px; height: 276px;
      background: white;
      border: 2px solid black;
      box-shadow: 0 0 30px black;
      -moz-transition-duration: 0.15s;
  }

  #info-meta {
      font-size: 10px;
      overflow: auto;
  }

  #meta > button {
      position: absolute;
      top: 0px;
      right: 0px;
      background-color: white;
      width: 20px; height: 20px;
      font-size: 10px;
      border: none;
      cursor: pointer;
  }
  #meta > button:hover {
      font-size: 11px;
  }

  #meta.hidden {
    -moz-transform: scale(0, 0);
    pointer-events: none;
  }

  #info-families {
      color: grey;
  }
  #info-families strong {
      color: white;
      background-color: black;
      padding: 1px 3px;
      border-radius: 3px;
  }
</style>

<body class="nonode">
  <div id="noview">
        No Node Selected.
  </div>
  <div id="view">
    <p><span id="info-family"></span>
      (<span id="info-format"></span>)
      - <button onclick="showMeta()"> see license and meta data.  </button>
    </p>
    <p>url: <input data-attribute="value" id="info-URI"></p>
    <p>color: <font id="info-color" data-attribute="color">⬛</font></p>
    <p>families:<span id="info-families"></span></p>
    <p>size:<span id="info-size"></span></p>
    <p>font-size-adjust:<span id="info-font-size-adjust"></span></p>
    <p>font-stretch:<span id="info-font-stretch"></span></p>
    <p>font-variant:<span id="info-font-variant"></span></p>
    <p>font-weight:<span id="info-font-weight"></span></p>
    <p>letter-spacing:<span id="info-letter-spacing"></span></p>
    <p>line-height:<span id="info-line-height"></span></p>
    <p>opacity:<span id="info-opacity"></span></p>
    <p>text-decoration:<span id="info-text-decoration"></span></p>
    <p>text-indent:<span id="info-text-indent"></span></p>
    <p>text-shadow:<span id="info-text-shadow"></span></p>
    <p>text-transform:<span id="info-text-transform"></span></p>
    <p>white-space:<span id="info-white-space"></span></p>
    <p>word-spacing:<span id="info-word-spacing"></span></p>
    <p>word-wrap:<span id="info-word-wrap"></span></p>
    <div class="hidden" id="meta">
      <pre id="info-meta"></pre>
      <button onclick="hideMeta()">✕</button>
    </div>
   </div>
</body>
